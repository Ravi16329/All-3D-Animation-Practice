<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3D Voice-Controlled Snake</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        background-color: #111827; /* bg-gray-900 */
      }
      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <div id="app" class="bg-gray-900 text-white min-h-screen flex flex-col items-center justify-center p-4 font-mono overflow-hidden">
      <header class="w-full max-w-4xl flex justify-between items-center mb-4 p-4 bg-gray-800/30 rounded-lg border border-gray-700">
        <h1 class="text-3xl font-black tracking-widest text-cyan-400">SNAKE_3D</h1>
        <div class="flex items-center gap-4">
           <div class="flex items-center gap-2 text-lg">
             <svg id="mic-icon" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-gray-500" viewBox="0 0 24 24" fill="currentColor">
               <path d="M12 2a3 3 0 00-3 3v6a3 3 0 006 0V5a3 3 0 00-3-3z"></path>
               <path d="M19 10v1a7 7 0 01-14 0v-1h2v1a5 5 0 0010 0v-1h2zM12 19a2 2 0 01-2 2H8a2 2 0 01-2-2v-3h2v3h2v-3h2v3h2v-3h2v3a2 2 0 01-2 2h-2a2 2 0 01-2-2v-1h-2v1z"></path>
             </svg>
             <span id="mic-status">OFF</span>
           </div>
           <div class="text-2xl font-bold bg-gray-900 px-4 py-1 rounded">
             SCORE: <span id="score" class="text-green-400">0</span>
           </div>
        </div>
      </header>
      
      <main class="relative" style="perspective: 1000px;">
        <div id="game-over-overlay" class="hidden absolute inset-0 bg-black bg-opacity-70 flex flex-col justify-center items-center backdrop-blur-sm z-20">
          <div class="text-center bg-gray-800/50 p-10 rounded-2xl border border-gray-700 shadow-2xl shadow-cyan-500/10">
            <h2 class="text-6xl font-black text-red-500 mb-2">GAME OVER</h2>
            <p class="text-3xl text-white mb-6">Final Score: <span id="final-score" class="font-bold text-cyan-400">0</span></p>
            <button id="restart-button" class="px-8 py-4 bg-cyan-500 text-gray-900 font-bold text-xl rounded-lg hover:bg-cyan-400 transform hover:scale-105 transition-all duration-300 shadow-lg shadow-cyan-500/30">
              Restart Game
            </button>
            <p class="text-gray-400 mt-4 text-sm">Or say "restart"</p>
          </div>
        </div>

        <div id="ready-overlay" class="absolute inset-0 bg-black bg-opacity-70 flex flex-col justify-center items-center backdrop-blur-sm z-20">
          <div class="text-center bg-gray-800/50 p-10 rounded-2xl border border-gray-700 shadow-2xl shadow-cyan-500/10">
            <h2 class="text-5xl font-black text-white mb-4">3D Voice Snake</h2>
            <div id="voice-supported">
              <div class="flex flex-col items-center gap-4 mb-6">
                  <svg id="ready-mic-icon" xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 text-gray-400" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2a3 3 0 00-3 3v6a3 3 0 006 0V5a3 3 0 00-3-3z"></path>
                    <path d="M19 10v1a7 7 0 01-14 0v-1h2v1a5 5 0 0010 0v-1h2zM12 19a2 2 0 01-2 2H8a2 2 0 01-2-2v-3h2v3h2v-3h2v3h2v-3h2v3a2 2 0 01-2 2h-2a2 2 0 01-2-2v-1h-2v1z"></path>
                  </svg>
                  <p id="mic-message" class="text-lg text-gray-300">Voice control is ready.</p>
                </div>
                <div class="text-left text-cyan-300 space-y-2 text-lg mb-8 p-4 bg-gray-900/50 rounded-lg">
                  <p class="font-bold">Commands:</p>
                  <p>- "Up", "Down", "Left", "Right"</p>
                  <p>- "Restart" (on game over)</p>
                </div>
                <button id="start-button" class="px-8 py-4 bg-green-500 text-gray-900 font-bold text-xl rounded-lg hover:bg-green-400 transform hover:scale-105 transition-all duration-300 shadow-lg shadow-green-500/30">
                  Start Manually
                </button>
            </div>
            <p id="voice-unsupported" class="hidden text-xl text-red-500">Your browser does not support voice recognition.</p>
          </div>
        </div>

        <div id="game-board" class="grid bg-gray-800 border-4 border-cyan-500/50 shadow-2xl shadow-cyan-500/20" style="
            grid-template-columns: repeat(20, 1fr);
            grid-template-rows: repeat(20, 1fr);
            width: clamp(300px, 90vw, 600px);
            height: clamp(300px, 90vw, 600px);
            transform-style: preserve-3d;
            transform: rotateX(55deg) rotateZ(0deg);
            background-image: linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px);
            background-size: 5% 5%;
          ">
        </div>
      </main>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
  // --- CONSTANTS ---
  const BOARD_SIZE = 20;
  const INITIAL_SPEED_MS = 200;
  const MIN_SPEED_MS = 80;
  const SPEED_INCREMENT = 5;
  const INITIAL_SNAKE = [
    { x: 10, y: 10 },
    { x: 10, y: 11 },
    { x: 10, y: 12 },
  ];
  const Direction = {
    UP: 'UP',
    DOWN: 'DOWN',
    LEFT: 'LEFT',
    RIGHT: 'RIGHT',
  };
  const GameState = {
    READY: 'READY',
    PLAYING: 'PLAYING',
    GAME_OVER: 'GAME_OVER',
  };

  // --- DOM ELEMENTS ---
  const gameBoard = document.getElementById('game-board');
  const scoreEl = document.getElementById('score');
  const finalScoreEl = document.getElementById('final-score');
  const gameOverOverlay = document.getElementById('game-over-overlay');
  const readyOverlay = document.getElementById('ready-overlay');
  const startButton = document.getElementById('start-button');
  const restartButton = document.getElementById('restart-button');
  const micIcon = document.getElementById('mic-icon');
  const readyMicIcon = document.getElementById('ready-mic-icon');
  const micStatus = document.getElementById('mic-status');
  const micMessage = document.getElementById('mic-message');
  const voiceSupportedDiv = document.getElementById('voice-supported');
  const voiceUnsupportedP = document.getElementById('voice-unsupported');

  // --- STATE ---
  let snake = [];
  let food = {};
  let direction = Direction.UP;
  let lastDirection = Direction.UP;
  let gameState = GameState.READY;
  let score = 0;
  let speed = INITIAL_SPEED_MS;
  let gameLoopInterval = null;

  // --- VOICE CONTROL ---
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  let recognition;

  const setupVoiceControl = (commands) => {
    if (!SpeechRecognition) {
      voiceSupportedDiv.classList.add('hidden');
      voiceUnsupportedP.classList.remove('hidden');
      return;
    }

    recognition = new SpeechRecognition();
    recognition.continuous = true;
    recognition.interimResults = false;
    recognition.lang = 'en-US';

    recognition.onresult = (event) => {
      const transcript = event.results[event.results.length - 1][0].transcript.trim().toLowerCase();
      if (commands[transcript]) {
        commands[transcript]();
      }
    };

    recognition.onend = () => {
      // If recognition stops, restart it to keep listening
      if (gameState !== GameState.GAME_OVER) {
         try { recognition.start(); } catch(e) { console.error("Recognition restart failed", e); }
      }
    };
    
    recognition.onerror = (event) => console.error('Speech recognition error:', event.error);
    
    try {
        recognition.start();
        updateMicStatus(true);
    } catch(e) {
        console.error("Could not start voice recognition", e);
        updateMicStatus(false);
    }
  };
  
  const updateMicStatus = (isListening) => {
      if(isListening) {
        micIcon.classList.remove('text-gray-500');
        micIcon.classList.add('text-green-400', 'animate-pulse');
        readyMicIcon.classList.remove('text-gray-400');
        readyMicIcon.classList.add('text-green-400', 'animate-pulse');
        micStatus.textContent = 'ON';
        micMessage.textContent = 'Listening... Say a direction to start!';
      } else {
        micIcon.classList.add('text-gray-500');
        micIcon.classList.remove('text-green-400', 'animate-pulse');
        readyMicIcon.classList.add('text-gray-400');
        readyMicIcon.classList.remove('text-green-400', 'animate-pulse');
        micStatus.textContent = 'OFF';
        micMessage.textContent = 'Voice control is ready.';
      }
  }

  // --- GAME LOGIC ---
  const generateFood = () => {
    while (true) {
      const newFood = {
        x: Math.floor(Math.random() * BOARD_SIZE),
        y: Math.floor(Math.random() * BOARD_SIZE),
      };
      if (!snake.some(segment => segment.x === newFood.x && segment.y === newFood.y)) {
        food = newFood;
        return;
      }
    }
  };
  
  const handleDirectionChange = (newDirection) => {
    if (gameState === GameState.GAME_OVER) return;

    if (gameState === GameState.READY) {
      setGameState(GameState.PLAYING);
    }
    
    const isOpposite = 
        (newDirection === Direction.UP && lastDirection === Direction.DOWN) ||
        (newDirection === Direction.DOWN && lastDirection === Direction.UP) ||
        (newDirection === Direction.LEFT && lastDirection === Direction.RIGHT) ||
        (newDirection === Direction.RIGHT && lastDirection === Direction.LEFT);

    if (!isOpposite) {
      direction = newDirection;
    }
  };

  const commands = {
    'up': () => handleDirectionChange(Direction.UP),
    'down': () => handleDirectionChange(Direction.DOWN),
    'left': () => handleDirectionChange(Direction.LEFT),
    'right': () => handleDirectionChange(Direction.RIGHT),
    'restart': () => {
        if (gameState === GameState.GAME_OVER) resetGame();
    },
  };

  const gameLoop = () => {
    const newSnake = [...snake];
    const head = { ...newSnake[0] };

    switch (direction) {
      case Direction.UP: head.y -= 1; break;
      case Direction.DOWN: head.y += 1; break;
      case Direction.LEFT: head.x -= 1; break;
      case Direction.RIGHT: head.x += 1; break;
    }
    
    lastDirection = direction;

    // Wall collision
    if (head.x < 0 || head.x >= BOARD_SIZE || head.y < 0 || head.y >= BOARD_SIZE) {
      setGameState(GameState.GAME_OVER);
      return;
    }

    // Self collision
    for (let i = 1; i < newSnake.length; i++) {
      if (head.x === newSnake[i].x && head.y === newSnake[i].y) {
        setGameState(GameState.GAME_OVER);
        return;
      }
    }

    newSnake.unshift(head);

    // Food consumption
    if (head.x === food.x && head.y === food.y) {
      score++;
      generateFood();
      speed = Math.max(MIN_SPEED_MS, speed - SPEED_INCREMENT);
      // Restart interval with new speed
      clearInterval(gameLoopInterval);
      gameLoopInterval = setInterval(gameLoop, speed);
    } else {
      newSnake.pop();
    }
    snake = newSnake;
    render();
  };
  
  const setGameState = (newState) => {
    gameState = newState;
    if (gameState === GameState.PLAYING) {
        readyOverlay.classList.add('hidden');
        gameOverOverlay.classList.add('hidden');
        gameLoopInterval = setInterval(gameLoop, speed);
    } else if (gameState === GameState.GAME_OVER) {
        clearInterval(gameLoopInterval);
        gameLoopInterval = null;
        if(recognition) recognition.stop();
        updateMicStatus(false);
        finalScoreEl.textContent = score;
        gameOverOverlay.classList.remove('hidden');
    } else if (gameState === GameState.READY) {
        if(recognition) recognition.start();
        updateMicStatus(true);
        readyOverlay.classList.remove('hidden');
    }
    render();
  }

  const resetGame = () => {
    snake = [...INITIAL_SNAKE];
    generateFood();
    direction = Direction.UP;
    lastDirection = Direction.UP;
    score = 0;
    speed = INITIAL_SPEED_MS;
    if (gameLoopInterval) clearInterval(gameLoopInterval);
    setGameState(GameState.READY);
  };

  // --- RENDERING ---
  const render = () => {
    // Render Board
    gameBoard.innerHTML = '';
    snake.forEach((segment, index) => {
      const el = document.createElement('div');
      el.style.gridColumnStart = segment.x + 1;
      el.style.gridRowStart = segment.y + 1;
      el.style.backgroundColor = index === 0 ? '#22d3ee' : '#06b6d4';
      el.style.transform = 'translateZ(5px)';
      el.style.boxShadow = '0 5px 15px rgba(0,0,0,0.4), inset 0 0 5px rgba(255,255,255,0.3)';
      el.style.borderRadius = '20%';
      el.style.opacity = 1 - (index / snake.length) * 0.5;
      gameBoard.appendChild(el);
    });

    const foodEl = document.createElement('div');
    foodEl.style.gridColumnStart = food.x + 1;
    foodEl.style.gridRowStart = food.y + 1;
    foodEl.className = 'bg-red-500 rounded-full animate-pulse';
    foodEl.style.transform = 'translateZ(5px)';
    foodEl.style.boxShadow = '0 0 20px 5px rgba(239, 68, 68, 0.7)';
    gameBoard.appendChild(foodEl);
    
    // Render UI
    scoreEl.textContent = score;
  };

  // --- INITIALIZATION ---
  startButton.addEventListener('click', () => setGameState(GameState.PLAYING));
  restartButton.addEventListener('click', resetGame);
  
  setupVoiceControl(commands);
  resetGame();
});

    </script>
  </body>
</html>


